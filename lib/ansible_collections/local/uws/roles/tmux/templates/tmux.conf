set -g mouse on


# -- Key bindings {{{

# Rebind the Prefix from default Ctrl+B to Alt+\
unbind C-b
set-option -g prefix M-\\
bind-key M-\\ send-prefix

# Command prompt: Alt+I
bind-key -n M-i command-prompt
# Command prompt: Alt+ш
bind-key -r 0xD0 display 'ш first byte'
bind-key -r 0xA8 command-prompt


# -- -- Windows {{{

# New window: Alt+L
bind-key -n M-l new-window -c "#{pane_current_path}"
bind-key -n M-д new-window -c "#{pane_current_path}"

# Prev / next window: Alt+, / Alt+.
bind-key -n M-, previous-window
bind-key -n M-б previous-window
bind-key -n M-. next-window
bind-key -n M-ю next-window

# Swap window left / right: Alt+; / Alt+'
bind-key -n M-\; { swap-window -t -1; select-window -t -1 }
bind-key -n M-ж { swap-window -t -1; select-window -t -1 }
bind-key -n M-\' { swap-window -t +1; select-window -t +1 }
bind-key -n M-э { swap-window -t +1; select-window -t +1 }

# -- -- Windows }}}


# -- -- Panes {{{

# Horizontal split: Alt+-
bind-key -n M-- split-window -v -c "#{pane_current_path}"

# Vertical split: Alt+=
bind-key -n M-= split-window -h -c "#{pane_current_path}"

# Kill pane: Alt+Z
bind-key -n M-z kill-pane
bind-key -n M-я kill-pane

# Prev / next pane: Ctrl+, / Ctrl+.
bind-key -n C-, select-pane -t -1
bind-key -n C-б select-pane -t -1
bind-key -n C-. select-pane -t +1
bind-key -n C-ю select-pane -t +1

# Swap pane Down / Up: Ctrl+; / Ctrl+'
bind-key -n C-\; swap-pane -D
bind-key -n C-ж swap-pane -D
bind-key -n C-\' swap-pane -U
bind-key -n C-э swap-pane -U

# Resize pane: Alt+[Arrow]
bind-key -n M-Up resize-pane -U 1
bind-key -n M-Down resize-pane -D 1
bind-key -n M-Left resize-pane -L 1
bind-key -n M-Right resize-pane -R 1

# Rebind the default horizontal splitting to Prefix+-
unbind '"'
bind - split-window -v -c "#{pane_current_path}"

# Rebind the default vertival splitting to Prefix+=
unbind %
bind = split-window -h -c "#{pane_current_path}"

# Move pane to the specified window: Alt+M
bind-key -n M-m command-prompt -p "Send pane to:" "join-pane -t '%%'"
bind-key -n M-ь command-prompt -p "Send pane to:" "join-pane -t '%%'"

# -- -- Panes }}}


# -- -- Vim mode {{{

# Enable
setw -g mode-keys vi

# Default vi-mode keys:
#   * Space - visual selection
#   * Enter - copy selected
#   * Prefix+] - paste
# But these binds are more vi-like:
#   v - to visual selection
bind -T copy-mode-vi v send -X begin-selection
#   y - to yank the selected
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
#   Prefix+P to paste (Ctrl+Shift+V works too)
bind p paste-buffer

# -- -- Vim mode }}}

# -- Key bindings }}}


set -g default-terminal "tmux-256color"

# True Color (24-bit) support.
set -ag terminal-overrides ",<<settings.desktop.terminal>>*:Tc"


# -- Status line {{{

# Enable status line explicitly. The tmux-continuum plugin uses a hook in
# status-right to run, so the status should be 'on'.
set-option -g status on

set -g status-interval 15  # seconds

set-option -g status-position bottom

set-option -g status-style fg=color15,bg=color241
set-option -g mode-style fg=color15,bg=color241
set-option -g message-style fg=black,bg=color109,bold


# -- -- Status middle {{{

# Non-active windows.
set-option -g window-status-format "\
#[fg=color109, bg=color235, bold]#F\
#[fg=color15]#I\
#[fg=color244, nobold]:#W"

# Current window.
set-window-option -g window-status-current-format "\
#[fg=color109, bg=color15, bold]#F\
#[fg=black]#I\
#[nobold]:#W"

# Non-current window with an acivity.
set-window-option -g window-status-activity-style "bg=color152"

# -- -- Status middle }}}


set-option -g status-left "\
#[fg=color15, bg=color241]#{?client_prefix,#[bg=color167],} #S "

set-option -g status-right " <<temperature>><<battery>>%d.%m.%Y %H:%M "

# Start index for windows and panes is 1, not 0.
set -g base-index 1
setw -g pane-base-index 1

# -- Status line }}}


# -- Plugins {{{

# Restore sessions. Automatically restore on tmux server start (once).
# Automatically save every `continuum-save-interval` minutes. Or manually
# save/restore on `Prefix+S`/`Prefix+R`.
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @continuum-restore "on"
set -g @continuum-save-interval "15"  # minutes

# Install plugins: Prefix+I or `~/.tmux/plugins/tpm/bin/install_plugins`
# Update plugins: Prefix+U or `~/.tmux/plugins/tpm/bin/update_plugins all`
# Uninstall plugins that are not `set -g @plugin`: Prefix+Alt+U
# or `~/.tmux/plugins/tpm/bin/clean_plugins`
set -g @plugin "tmux-plugins/tpm"

run "~/.tmux/plugins/tpm/tpm"

# -- Plugins }}}
