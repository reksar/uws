- name: "/!/ Niri packages"
  package:
    name:

      - "niri"
      - "xwayland-satellite"

      # To parse some Niri output.
      - "jq"

  become: true

- name: "/!/ Niri user dirs"
  loop:
    - "{{ config_dir }}"
    - "{{ share_dir }}"
  file:
    path: "{{ item }}"
    state: "directory"

- name: "/>/ Niri scripts"
  loop:
    - "app-window.sh"
    - "focus-next-window.sh"
  copy:
    src: "{{ item }}"
    dest: "{{ share_dir }}/"
    mode: "u=rwx,g=rx,o=rx"

- import_tasks: "{{ role_path }}/../locale/tasks/keymap/desktop.yml"

- import_tasks: "touchscreen/main.yml"

- name: "/>/ App windows config"
  template:
    src: "app_windows"
    dest: "{{ config_dir }}/"

- name: "/>/ Niri config"
  template:
    src: "config.kdl"
    dest: "{{ config_dir }}/"
    variable_start_string: "<<"
    variable_end_string: ">>"
    block_start_string: "<%"
    block_end_string: "%>"
  notify: "Reload Niri config"
