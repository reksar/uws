# Apply the GTK theme from uws settings to applications.
#
# NOTE: Some GTK applications may be running as daemon that need to be reloaded
# to apply new theme. Check out the `ps aux` and `busctl --user list`.

- set_fact:
    theme: "{{ settings.desktop.gtk.theme }}"

# This is mainly for GTK4, but some GTK3 apps also support the settings.
- name: "/*/ GTK theme"
  loop:
    - "gtk-3.0"
    - "gtk-4.0"
  local.uws.config_option:
    file: "{{ ansible_env.HOME }}/.config/{{ item }}/settings.ini"
    section: "Settings"
    option: "gtk-theme-name"
    value: "{{ theme }}"

# Most of GTK3 apps use the $GTK_THEME env var.
- include_tasks: "set_env.yml"
  vars:
    gtk_opt: "GTK_THEME"
    gtk_val: "{{ theme }}"

# Some GNOME apps may get the gtk-theme from gsettings (dconf).
- include_tasks: "set_dconf.yml"
  vars:
    gtk_opt: "gtk-theme"
    gtk_val: "{{ theme }}"
