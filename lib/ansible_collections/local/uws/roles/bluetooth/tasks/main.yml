- name: "/?/ PCI Bluetooth"
  shell: "lspci | grep -i bluetooth"
  changed_when: false
  failed_when: false
  register: pci

- name: "/?/ USB Bluetooth"
  shell: "lsusb | grep -i bluetooth"
  changed_when: false
  failed_when: false
  register: usb

- name: "Bluetooth setup"
  when: not (pci.rc and usb.rc)
  block:

  - import_tasks: "packages.yml"
  - import_tasks: "btusb.yml"
  - import_tasks: "hidp.yml"
  - import_tasks: "config.yml"

  - name: "/*/ Bluetooth service"
    systemd:
      name: "bluetooth.service"
      state: "started"
      enabled: true
    become: true
